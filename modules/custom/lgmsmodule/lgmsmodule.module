<?php

use Drupal\taxonomy\Entity\Vocabulary;
use Drupal\taxonomy\Entity\Term;

/**
 * Implements hook_theme().
 */
function lgmsmodule_theme($existing, $type, $theme, $path) {
  return [
    'lgmsmodule_content' => [
      'variables' => ['table' => NULL],
      'template' => 'lgmsmodule-content',
    ],
  ];
}


/**
 * Creates a taxonomy vocabulary if it doesn't already exist.
 *
 * @param string $vid The machine name of the vocabulary.
 * @param string $name The human-readable name of the vocabulary.
 * @return void
 * @throws \Drupal\Core\Entity\EntityStorageException
 */
function create_vocab(string $vid, string $name): void {
  if (!\Drupal\taxonomy\Entity\Vocabulary::load($vid)) {
    $vocabulary = \Drupal\taxonomy\Entity\Vocabulary::create([
      'vid' => $vid,
      'name' => $name,
    ]);
    $vocabulary->save();
  }
}


/**
 * Adds terms to a taxonomy vocabulary if they don't already exist.
 *
 * @param array $terms The terms to add.
 * @param string $vid The machine name of the vocabulary.
 * @return void
 * @throws \Drupal\Core\Entity\EntityStorageException
 */
function add_terms(array $terms, string $vid): void {
  foreach ($terms as $term_name) {
    // Check if the term already exists.
    $existing_terms = \Drupal::entityTypeManager()
      ->getStorage('taxonomy_term')
      ->loadByProperties(['name' => $term_name, 'vid' => $vid]);

    if (empty($existing_terms)) {
      $new_term = \Drupal\taxonomy\Entity\Term::create([
        'vid' => $vid,
        'name' => $term_name,
      ]);
      $new_term->enforceIsNew();
      $new_term->save();
    }
  }
}


/**
 * Implements hook_install().
 * @throws \Drupal\Core\Entity\EntityStorageException
 */
function lgmsModule_install() {

  // Create a new Guide Type taxonomy.
  create_vocab('LGMS Guide Type', 'Guide Type');

  // Add terms to the Guide Type taxonomy
  $terms = array(
    'General purpose Guide',
    'Subject Guide',
    'Topic Guide',
    'Course Guide',
  );
  add_terms($terms, 'LGMS Guide Type');


  // Create a new Guide Subject taxonomy.
  create_vocab('LGMS Guide Subject', 'Guide Subject');

  // Add terms to the Guide Subject taxonomy
  $terms = array(
    'Biology',
    'Psychology ',
    'Music',
    'Modern Languages',
  );
  add_terms($terms, 'LGMS Guide Subject');


  // Create a new Guide Group taxonomy.
  create_vocab('LGMS Guide Group', 'Guide Group');

  // Add terms to the Guide Group taxonomy
  $terms = array(
    'Group 1',
    'Group 2',
    'Group 3',
    'Group 4',
  );
  add_terms($terms, 'LGMS Guide Group');

}
